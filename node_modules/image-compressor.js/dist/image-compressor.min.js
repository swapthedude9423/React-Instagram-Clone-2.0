/*!
 * Image Compressor v1.1.1
 * https://github.com/xkeshi/image-compressor
 *
 * Copyright (c) 2017-2018 Xkeshi
 * Released under the MIT license
 *
 * Date: 2018-02-28T02:34:44.169Z
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.ImageCompressor=t()}(this,function(){"use strict";var e,t=(function(e){var t,r,n,a,i,o,l;t=window,r=t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype,n=t.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),a=n&&t.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),i=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder,o=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,l=(n||i)&&t.atob&&t.ArrayBuffer&&t.Uint8Array&&function(e){var t,r,l,u,c,s,f,h,m;if(!(t=e.match(o)))throw new Error("invalid data URI");for(r=t[2]?t[1]:"text/plain"+(t[3]||";charset=US-ASCII"),l=!!t[4],u=e.slice(t[0].length),c=l?atob(u):decodeURIComponent(u),s=new ArrayBuffer(c.length),f=new Uint8Array(s),h=0;h<c.length;h+=1)f[h]=c.charCodeAt(h);return n?new Blob([a?f:s],{type:r}):((m=new i).append(s),m.getBlob(r))},t.HTMLCanvasElement&&!r.toBlob&&(r.mozGetAsFile?r.toBlob=function(e,t,n){var a=this;setTimeout(function(){n&&r.toDataURL&&l?e(l(a.toDataURL(t,n))):e(a.mozGetAsFile("blob",t))})}:r.toDataURL&&l&&(r.toBlob=function(e,t,r){var n=this;setTimeout(function(){e(l(n.toDataURL(t,r)))})})),e.exports?e.exports=l:t.dataURLtoBlob=l}(e={exports:{}},e.exports),e.exports),r=Object.prototype.toString,n={checkOrientation:!0,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,quality:.8,mimeType:"auto",convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},a=/^image\/.+$/;function i(e){return a.test(e)}var o=String.fromCharCode;var l=window.btoa;function u(e){var t=new DataView(e),r=void 0,n=void 0,a=void 0,i=void 0;if(255===t.getUint8(0)&&216===t.getUint8(1))for(var l=t.byteLength,u=2;u<l;){if(255===t.getUint8(u)&&225===t.getUint8(u+1)){a=u;break}u+=1}if(a){var c=a+10;if("Exif"===function(e,t,r){var n="",a=void 0;for(r+=t,a=t;a<r;a+=1)n+=o(e.getUint8(a));return n}(t,a+4,4)){var s=t.getUint16(c);if(((n=18761===s)||19789===s)&&42===t.getUint16(c+2,n)){var f=t.getUint32(c+4,n);f>=8&&(i=c+f)}}}if(i){var h=t.getUint16(i,n),m=void 0,d=void 0;for(d=0;d<h;d+=1)if(m=i+12*d+2,274===t.getUint16(m,n)){m+=8,r=t.getUint16(m,n),t.setUint16(m,1,n);break}}return r}var c=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},h=window,m=h.ArrayBuffer,d=h.FileReader,b=window.URL||window.webkitURL,v=/\.\w+$/;return function(){function e(t,r){c(this,e),this.result=null,t&&this.compress(t,r)}return s(e,[{key:"compress",value:function(e,a){var c=this,s=new Image;return a=f({},n,a),m||(a.checkOrientation=!1),new Promise(function(t,n){if((c=e)instanceof Blob||"[object Blob]"===r.call(c)){var c,s=e.type;if(i(s))if(b||d){if(b&&!a.checkOrientation)t(b.createObjectURL(e));else if(d){var h=new d,m=a.checkOrientation&&"image/jpeg"===s;h.onload=function(e){var r=e.target.result;t(m?f({url:function(e,t){var r=new Uint8Array(e),n=r.length,a="",i=void 0;for(i=0;i<n;i+=1)a+=o(r[i]);return"data:"+t+";base64,"+l(a)}(r,s)},function(e){var t=0,r=1,n=1;switch(e){case 2:r=-1;break;case 3:t=-180;break;case 4:n=-1;break;case 5:t=90,n=-1;break;case 6:t=90;break;case 7:t=90,r=-1;break;case 8:t=-90}return{rotate:t,scaleX:r,scaleY:n}}(u(r))):{url:r})},h.onabort=n,h.onerror=n,m?h.readAsArrayBuffer(e):h.readAsDataURL(e)}}else n(new Error("The current browser does not support image compression."));else n(new Error("The first argument must be an image File or Blob object."))}else n(new Error("The first argument must be a File or Blob object."))}).then(function(t){return new Promise(function(r,n){s.onload=function(){return r(f({},t,{naturalWidth:s.naturalWidth,naturalHeight:s.naturalHeight}))},s.onabort=n,s.onerror=n,s.alt=e.name,s.src=t.url})}).then(function(r){var n=r.naturalWidth,o=r.naturalHeight,l=r.rotate,u=void 0===l?0:l,f=r.scaleX,h=void 0===f?1:f,m=r.scaleY,d=void 0===m?1:m;return new Promise(function(r){var l=document.createElement("canvas"),f=l.getContext("2d"),m=n/o,b=Math.max(a.maxWidth,0)||1/0,v=Math.max(a.maxHeight,0)||1/0,g=Math.max(a.minWidth,0)||0,w=Math.max(a.minHeight,0)||0,p=n,y=o;if(b<1/0&&v<1/0?v*m>b?v=b/m:b=v*m:b<1/0?v=b/m:v<1/0&&(b=v*m),g>0&&w>0?w*m>g?w=g/m:g=w*m:g>0?w=g/m:w>0&&(g=w*m),a.width>0)y=(p=a.width)/m;else if(a.height>0){p=(y=a.height)*m}var U=-(p=Math.min(Math.max(p,g),b))/2,B=-(y=Math.min(Math.max(y,w),v))/2,M=p,x=y;if(Math.abs(u)%180==90){var T={width:y,height:p};p=T.width,y=T.height}l.width=p,l.height=y,i(a.mimeType)||(a.mimeType=e.type);var k="transparent";e.size>a.convertSize&&"image/png"===a.mimeType&&(k="#fff",a.mimeType="image/jpeg"),f.fillStyle=k,f.fillRect(0,0,p,y),f.save(),f.translate(p/2,y/2),f.rotate(u*Math.PI/180),f.scale(h,d),a.beforeDraw&&a.beforeDraw.call(c,f,l),f.drawImage(s,Math.floor(U),Math.floor(B),Math.floor(M),Math.floor(x)),a.drew&&a.drew.call(c,f,l),f.restore();var A=function(e){r({naturalWidth:n,naturalHeight:o,result:e})};l.toBlob?l.toBlob(A,a.mimeType,a.quality):A(t(l.toDataURL(a.mimeType,a.quality)))})}).then(function(t){var r=t.naturalWidth,n=t.naturalHeight,o=t.result;if(b&&b.revokeObjectURL(s.src),o)if(o.size>e.size&&a.mimeType===e.type&&!(a.width>r||a.height>n||a.minWidth>r||a.minHeight>n))o=e;else{var l=new Date;o.lastModified=l.getTime(),o.lastModifiedDate=l,o.name=e.name,o.name&&o.type!==e.type&&(o.name=o.name.replace(v,function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=i(e)?e.substr(6):"";return"jpeg"===r&&(r="jpg"),r&&t&&(r="."+r),r}(o.type)))}else o=e;return c.result=o,a.success&&a.success.call(c,o),Promise.resolve(o)}).catch(function(e){if(!a.error)throw e;a.error.call(c,e)})}}]),e}()});